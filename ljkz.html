<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çµå¢ƒå®¢æ ˆ</title>
    <style>
        /* å¼ºåˆ¶æ¨ªå± */
        @media screen and (orientation: portrait) {
            body::before {
                content: "è¯·å°†æ‰‹æœºæ¨ªå±ä½¿ç”¨ï¼";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #1a1a2e;
                color: white;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 24px;
                z-index: 9999;
            }
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #1a1a2e;
            color: #e6e6e6;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        /* åŠ è½½ç•Œé¢ */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-logo {
            font-size: 80px;
            margin-bottom: 30px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .progress-container {
            width: 300px;
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        #progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        #loading-text {
            font-size: 18px;
            margin-top: 20px;
        }
        
        /* æ¸¸æˆä¸»ç•Œé¢ - æ¨ªå±å¸ƒå±€ */
        #game {
            display: none;
            width: 100vw;
            height: 100vh;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .game-container {
            display: flex;
            height: 100%;
            gap: 10px;
        }
        
        /* å·¦ä¾§ï¼šçŠ¶æ€é¢æ¿ */
        .left-panel {
            width: 250px;
            background: linear-gradient(135deg, #2d3047, #1a1a2e);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #444;
            display: flex;
            flex-direction: column;
        }
        
        /* ä¸­é—´ï¼šå®¢äººåŒºåŸŸ */
        .center-panel {
            flex: 1;
            background: linear-gradient(135deg, #2d3047, #1a1a2e);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #444;
            overflow-y: auto;
        }
        
        /* å³ä¾§ï¼šæ“ä½œé¢æ¿ */
        .right-panel {
            width: 300px;
            background: linear-gradient(135deg, #2d3047, #1a1a2e);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #444;
            display: flex;
            flex-direction: column;
        }
        
        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #444;
        }
        
        #day-display {
            font-size: 24px;
            color: #FFD700;
            font-weight: bold;
        }
        
        #weather {
            font-size: 18px;
            color: #87CEEB;
            background: rgba(135, 206, 235, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        /* èµ„æºæ˜¾ç¤º */
        .resources {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .resource-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #555;
        }
        
        .resource-name {
            font-size: 16px;
        }
        
        .resource-value {
            font-size: 22px;
            font-weight: bold;
        }
        
        #silver-value { color: #C0C0C0; }
        #merit-value { color: #FFD700; }
        #rice-value { color: #98FB98; }
        #reputation-value { color: #9370DB; }
        
        /* æŒ‰é’® - ä¸­ç­‰å¤§å° */
        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 14px 20px;
            margin: 8px 0;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* ç‰¹æ®ŠæŒ‰é’®æ ·å¼ */
        .btn-special {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #F44336, #D32F2F);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        
        /* å®¢äººå¡ç‰‡ */
        .guest-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 12px 0;
            border: 2px solid #555;
        }
        
        .guest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .guest-name {
            font-size: 20px;
            color: #FFD700;
            font-weight: bold;
        }
        
        .guest-type {
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .type-live { background: #2E8B57; }
        .type-ghost { background: #8B008B; }
        .type-special { background: #FF9800; }
        
        .guest-desc {
            color: #ccc;
            margin: 10px 0;
            font-style: italic;
        }
        
        .guest-needs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .need-box, .reward-box {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
        }
        
        .need-box {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #FF6B6B;
        }
        
        .reward-box {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ECDC4;
        }
        
        .guest-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .guest-actions .btn {
            padding: 10px;
            font-size: 16px;
            margin: 0;
        }
        
        /* äº‹ä»¶é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 1000;
            max-width: 300px;
            display: none;
            animation: slideIn 0.3s, fadeOut 0.3s 2.7s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* ç©ºçŠ¶æ€æç¤º */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }
        
        .empty-state-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        /* å›¾æ ‡å¤§å° */
        .icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .btn .icon {
            font-size: 20px;
        }
        
        /* æŒ‰é’®ç»„ */
        .btn-group {
            margin: 15px 0;
        }
        
        .btn-group-title {
            font-size: 18px;
            color: #FFD700;
            margin-bottom: 10px;
            padding-left: 10px;
            border-left: 3px solid #FFD700;
        }
        
        /* å¤©æ°”ç‰¹æ•ˆ */
        .weather-effect {
            background: rgba(135, 206, 235, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #87CEEB;
            text-align: center;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-height: 600px) {
            .btn { padding: 12px 16px; font-size: 16px; }
            .guest-card { padding: 12px; }
            .resource-item { padding: 10px; }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="loading">
        <div class="loading-logo">ğŸ’¬</div>
        <h2>çµå¢ƒå®¢æ ˆ</h2>
        <div class="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div id="loading-text">æ­£åœ¨è¿æ¥é˜´é˜³ä¸¤ç•Œ...</div>
    </div>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game">
        <div class="game-container">
            <!-- å·¦ä¾§ï¼šçŠ¶æ€é¢æ¿ -->
            <div class="left-panel">
                <div class="top-bar">
                    <div id="day-display">ç¬¬ <span id="current-day">1</span> å¤©</div>
                    <div id="weather">â˜€ï¸ æ™´æœ—</div>
                </div>
                
                <div class="weather-effect" id="weather-effect">
                    ä»Šæ—¥å¤©æ°”è‰¯å¥½ï¼Œå®¢äººå‡ºç°ç‡+20%
                </div>
                
                <div class="resources">
                    <div class="resource-item">
                        <div class="resource-name">ğŸ’° ç™½é“¶</div>
                        <div id="silver-value" class="resource-value">100</div>
                    </div>
                    <div class="resource-item">
                        <div class="resource-name">ğŸ™ åŠŸå¾·</div>
                        <div id="merit-value" class="resource-value">100</div>
                    </div>
                    <div class="resource-item">
                        <div class="resource-name">ğŸš é˜´ç±³</div>
                        <div id="rice-value" class="resource-value">20</div>
                    </div>
                    <div class="resource-item">
                        <div class="resource-name">â­ å£°æœ›</div>
                        <div id="reputation-value" class="resource-value">0</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <div class="btn-group-title">å®¢æ ˆä¿¡æ¯</div>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                        <div>ç­‰çº§ï¼š<span id="inn-level">1</span></div>
                        <div>å®¹é‡ï¼š<span id="max-guests">3</span>/3</div>
                        <div>é˜´ç±³äº§å‡ºï¼š<span id="rice-per-day">5</span>/å¤©</div>
                    </div>
                </div>
            </div>
            
            <!-- ä¸­é—´ï¼šå®¢äººåŒºåŸŸ -->
            <div class="center-panel" id="guests-panel">
                <!-- å®¢äººåˆ—è¡¨ä¼šåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                <div class="empty-state" id="empty-guests">
                    <div class="empty-state-icon">ğŸ®</div>
                    <div style="font-size: 20px; margin-bottom: 10px;">å®¢æ ˆç©ºç©ºå¦‚ä¹Ÿ</div>
                    <div>ç‚¹å‡»"å¬å”¤å®¢äºº"æŒ‰é’®å¬å”¤å®¢äºº</div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šæ“ä½œé¢æ¿ -->
            <div class="right-panel">
                <div class="btn-group">
                    <div class="btn-group-title">å®¢äººç®¡ç†</div>
                    <button class="btn" onclick="generateGuest()">
                        <span class="icon">ğŸ‘¥</span>å¬å”¤å®¢äºº
                    </button>
                    <button class="btn btn-warning" onclick="refreshGuests()">
                        <span class="icon">ğŸ”„</span>åˆ·æ–°å®¢äºº
                    </button>
                </div>
                
                <div class="btn-group">
                    <div class="btn-group-title">å®¢æ ˆæ“ä½œ</div>
                    <button class="btn btn-special" onclick="explore()">
                        <span class="icon">ğŸ—ºï¸</span>å¤–å‡ºæ¢ç´¢
                    </button>
                    <button class="btn" onclick="upgradeInn()">
                        <span class="icon">ğŸ—ï¸</span>å®¢æ ˆå‡çº§
                    </button>
                    <button class="btn" onclick="nextDay()">
                        <span class="icon">ğŸ“…</span>è¿›å…¥ä¸‹ä¸€å¤©
                    </button>
                </div>
                
                <div class="btn-group">
                    <div class="btn-group-title">æ¸¸æˆç®¡ç†</div>
                    <button class="btn" onclick="saveGame()">
                        <span class="icon">ğŸ’¾</span>ä¿å­˜æ¸¸æˆ
                    </button>
                    <button class="btn" onclick="loadGame()">
                        <span class="icon">ğŸ“‚</span>åŠ è½½æ¸¸æˆ
                    </button>
                    <button class="btn btn-danger" onclick="resetGame()">
                        <span class="icon">ğŸ”„</span>é‡ç½®æ¸¸æˆ
                    </button>
                </div>
                
                <div class="btn-group">
                    <div class="btn-group-title">ç‰¹æ®ŠåŠŸèƒ½</div>
                    <button class="btn btn-special" onclick="useSpecialPower()">
                        <span class="icon">âœ¨</span>ä½¿ç”¨ç¥é€š
                    </button>
                    <button class="btn" onclick="checkAchievements()">
                        <span class="icon">ğŸ†</span>æŸ¥çœ‹æˆå°±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥åŒºåŸŸ -->
    <div id="notification" class="notification"></div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            silver: 100,
            merit: 100,
            rice: 20,
            reputation: 0,
            day: 1,
            weather: "æ™´æœ—",
            guests: [],
            innLevel: 1,
            maxGuests: 3,
            ricePerDay: 5,
            specialPower: 3,
            achievements: []
        };

        // å®¢äººç±»å‹
        const guestTypes = [
            { name: "ä¹¦ç”Ÿ", type: "æ´»äºº", desc: "èµ´äº¬èµ¶è€ƒçš„ä¹¦ç”Ÿ", need: "silver", needAmount: 3, reward: "silver", rewardAmount: 8, rarity: "æ™®é€š" },
            { name: "å•†äºº", type: "æ´»äºº", desc: "è¥¿åŸŸæ¥çš„èƒ¡å•†", need: "silver", needAmount: 8, reward: "silver", rewardAmount: 15, rarity: "æ™®é€š" },
            { name: "ä¾ å®¢", type: "æ´»äºº", desc: "è¡Œèµ°æ±Ÿæ¹–çš„å‰‘å®¢", need: "silver", needAmount: 5, reward: "silver", rewardAmount: 10, rarity: "æ™®é€š" },
            { name: "å®˜å‘˜", type: "æ´»äºº", desc: "å¾®æœç§è®¿çš„å®˜å‘˜", need: "silver", needAmount: 12, reward: "silver", rewardAmount: 25, rarity: "ç¨€æœ‰" },
            { name: "å†œå¤«", type: "æ´»äºº", desc: "è¿›åŸå–èœçš„å†œæ°‘", need: "silver", needAmount: 2, reward: "silver", rewardAmount: 5, rarity: "æ™®é€š" },
            { name: "å’Œå°š", type: "æ´»äºº", desc: "åŒ–ç¼˜çš„åƒ§äºº", need: "silver", needAmount: 1, reward: "merit", rewardAmount: 3, rarity: "æ™®é€š" },
            { name: "åŒ»ç”Ÿ", type: "æ´»äºº", desc: "é‡‡è¯çš„éƒä¸­", need: "silver", needAmount: 4, reward: "silver", rewardAmount: 9, rarity: "æ™®é€š" },
            { name: "æ­Œå¥³", type: "æ´»äºº", desc: "å–è‰ºçš„æ­Œå§¬", need: "silver", needAmount: 6, reward: "silver", rewardAmount: 13, rarity: "æ™®é€š" },
            { name: "é¥¿æ­»é¬¼", type: "äº¡çµ", desc: "é¥¥é¥¿çš„äº¡çµ", need: "merit", needAmount: 2, reward: "merit", rewardAmount: 5, rarity: "æ™®é€š" },
            { name: "æ°´é¬¼", type: "äº¡çµ", desc: "æººæ°´çš„é­‚é­„", need: "merit", needAmount: 3, reward: "merit", rewardAmount: 7, rarity: "æ™®é€š" },
            { name: "åŠæ­»é¬¼", type: "äº¡çµ", desc: "ä¸ŠåŠçš„äº¡çµ", need: "merit", needAmount: 4, reward: "merit", rewardAmount: 9, rarity: "æ™®é€š" },
            { name: "æ— å¤´é¬¼", type: "äº¡çµ", desc: "æ²¡æœ‰å¤´çš„äº¡çµ", need: "merit", needAmount: 6, reward: "merit", rewardAmount: 12, rarity: "ç¨€æœ‰" },
            { name: "å†¤æ­»é¬¼", type: "äº¡çµ", desc: "å«å†¤è€Œæ­»çš„é­‚é­„", need: "merit", needAmount: 5, reward: "merit", rewardAmount: 11, rarity: "æ™®é€š" },
            { name: "ç—…é¬¼", type: "äº¡çµ", desc: "ç—…æ­»çš„äº¡çµ", need: "merit", needAmount: 3, reward: "merit", rewardAmount: 6, rarity: "æ™®é€š" },
            { name: "æˆ˜é¬¼", type: "äº¡çµ", desc: "æˆ˜æ­»çš„å£«å…µ", need: "merit", needAmount: 7, reward: "merit", rewardAmount: 15, rarity: "ç¨€æœ‰" },
            { name: "å©´çµ", type: "äº¡çµ", desc: "å¤­æŠ˜çš„å©´å„¿é­‚é­„", need: "merit", needAmount: 1, reward: "merit", rewardAmount: 4, rarity: "æ™®é€š" }
        ];

        // å¤©æ°”æ•ˆæœ
        const weatherEffects = {
            "æ™´æœ—": { icon: "â˜€ï¸", effect: "å®¢äººå‡ºç°ç‡+20%", multiplier: 1.2 },
            "é˜´å¤©": { icon: "â˜ï¸", effect: "ä¸€åˆ‡æ­£å¸¸", multiplier: 1.0 },
            "é›¨å¤©": { icon: "ğŸŒ§ï¸", effect: "å®¢äººå‡ºç°ç‡-30%", multiplier: 0.7 },
            "æœˆåœ†": { icon: "ğŸŒ•", effect: "äº¡çµå®¢äººå¥–åŠ±+50%", multiplier: 1.5 }
        };

        // åŠ è½½åŠ¨ç”»
        function startLoading() {
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 2;
                progressBar.style.width = progress + '%';
                
                if (progress <= 30) loadingText.textContent = "æ­£åœ¨è¿æ¥é˜´é˜³ä¸¤ç•Œ...";
                else if (progress <= 60) loadingText.textContent = "åŠ è½½å®¢äººæ•°æ®...";
                else if (progress <= 90) loadingText.textContent = "åˆå§‹åŒ–å®¢æ ˆç³»ç»Ÿ...";
                else loadingText.textContent = "å‡†å¤‡è¿æ¥å®¢äºº...";
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(finishLoading, 500);
                }
            }, 50);
        }

        // å®ŒæˆåŠ è½½
        function finishLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            updateDisplay();
            showNotification("æ¬¢è¿æ¥åˆ°çµå¢ƒå®¢æ ˆï¼", "success");
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            // æ›´æ–°èµ„æº
            document.getElementById('silver-value').textContent = gameState.silver;
            document.getElementById('merit-value').textContent = gameState.merit;
            document.getElementById('rice-value').textContent = gameState.rice;
            document.getElementById('reputation-value').textContent = gameState.reputation;
            
            // æ›´æ–°å¤©æ•°
            document.getElementById('current-day').textContent = gameState.day;
            
            // æ›´æ–°å¤©æ°”
            const weather = weatherEffects[gameState.weather];
            document.getElementById('weather').innerHTML = `${weather.icon} ${gameState.weather}`;
            document.getElementById('weather-effect').textContent = `ä»Šæ—¥å¤©æ°”ï¼š${gameState.weather}ï¼Œ${weather.effect}`;
            
            // æ›´æ–°å®¢æ ˆä¿¡æ¯
            document.getElementById('inn-level').textContent = gameState.innLevel;
            document.getElementById('max-guests').textContent = `${gameState.guests.length}/${gameState.maxGuests}`;
            document.getElementById('rice-per-day').textContent = gameState.ricePerDay;
            
            // æ›´æ–°å®¢äººåˆ—è¡¨
            displayGuests();
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = "info") {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            // è®¾ç½®é¢œè‰²
            const colors = {
                success: "linear-gradient(135deg, #4CAF50, #45a049)",
                warning: "linear-gradient(135deg, #FF9800, #F57C00)",
                error: "linear-gradient(135deg, #F44336, #D32F2F)",
                info: "linear-gradient(135deg, #2196F3, #1976D2)"
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // æ˜¾ç¤ºå®¢äºº
        function displayGuests() {
            const guestsPanel = document.getElementById('guests-panel');
            const emptyGuests = document.getElementById('empty-guests');
            
            if (gameState.guests.length === 0) {
                emptyGuests.style.display = 'block';
                return;
            }
            
            emptyGuests.style.display = 'none';
            guestsPanel.innerHTML = '';
            
            gameState.guests.forEach((guest, index) => {
                const guestCard = document.createElement('div');
                guestCard.className = 'guest-card';
                
                // è®¡ç®—å¤©æ°”å½±å“çš„å¥–åŠ±
                const weatherEffect = weatherEffects[gameState.weather];
                const finalReward = Math.floor(guest.rewardAmount * 
                    (guest.type === "äº¡çµ" && gameState.weather === "æœˆåœ†" ? 1.5 : 1.0));
                
                guestCard.innerHTML = `
                    <div class="guest-header">
                        <div class="guest-name">${guest.name}</div>
                        <div class="guest-type ${guest.type === 'æ´»äºº' ? 'type-live' : 'type-ghost'}">
                            ${guest.type} Â· ${guest.rarity}
                        </div>
                    </div>
                    <div class="guest-desc">${guest.desc}</div>
                    <div class="guest-needs">
                        <div class="need-box">
                            <div>éœ€è¦</div>
                            <div style="font-size: 18px; color: #FF6B6B; margin-top: 5px;">
                                ${guest.needAmount} ${guest.need === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}
                            </div>
                        </div>
                        <div class="reward-box">
                            <div>å¥–åŠ±</div>
                            <div style="font-size: 18px; color: #4ECDC4; margin-top: 5px;">
                                ${finalReward} ${guest.reward === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}
                            </div>
                        </div>
                    </div>
                    <div class="guest-actions">
                        <button class="btn" onclick="serveGuest(${index})" ${canServe(guest) ? '' : 'disabled'}>
                            æ‹›å¾…
                        </button>
                        <button class="btn btn-special" onclick="chatGuest(${index})">
                            äº¤æµ
                        </button>
                        <button class="btn" onclick="bargainGuest(${index})">
                            è®®ä»·
                        </button>
                        <button class="btn btn-danger" onclick="refuseGuest(${index})">
                            æ‹’ç»
                        </button>
                    </div>
                `;
                
                guestsPanel.appendChild(guestCard);
            });
        }

        // æ£€æŸ¥æ˜¯å¦èƒ½æ‹›å¾…
        function canServe(guest) {
            if (guest.need === 'silver') {
                return gameState.silver >= guest.needAmount;
            } else {
                return gameState.merit >= guest.needAmount;
            }
        }

        // ç”Ÿæˆéšæœºå¤©æ°”
        function generateWeather() {
            const weathers = Object.keys(weatherEffects);
            gameState.weather = weathers[Math.floor(Math.random() * weathers.length)];
        }

        // å¬å”¤å®¢äºº
        function generateGuest() {
            if (gameState.guests.length >= gameState.maxGuests) {
                showNotification(`å®¢æ ˆå·²æ»¡ï¼æœ€å¤šåªèƒ½æœ‰ ${gameState.maxGuests} ä½å®¢äººã€‚`, "warning");
                return;
            }
            
            // å¤©æ°”å½±å“å‡ºç°æ¦‚ç‡
            const weatherEffect = weatherEffects[gameState.weather];
            if (Math.random() > weatherEffect.multiplier) {
                showNotification("ä»Šå¤©å¤©æ°”ä¸å¥½ï¼Œæ²¡æœ‰å®¢äººå‰æ¥", "warning");
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * guestTypes.length);
            const guest = { ...guestTypes[randomIndex], id: Date.now() };
            
            gameState.guests.push(guest);
            updateDisplay();
            showNotification(`${guest.name}æ¥åˆ°äº†å®¢æ ˆ`, "success");
        }

        // åˆ·æ–°å®¢äºº
        function refreshGuests() {
            if (gameState.guests.length > 0) {
                if (!confirm("ç¡®å®šè¦åˆ·æ–°æ‰€æœ‰å®¢äººå—ï¼Ÿå½“å‰å®¢äººä¼šå…¨éƒ¨ç¦»å¼€ã€‚")) {
                    return;
                }
            }
            
            gameState.guests = [];
            for (let i = 0; i < 3; i++) {
                generateGuest();
            }
            
            showNotification("å·²åˆ·æ–°æ‰€æœ‰å®¢äºº", "info");
        }

        // æ‹›å¾…å®¢äºº
        function serveGuest(index) {
            const guest = gameState.guests[index];
            
            if (!canServe(guest)) {
                showNotification(`èµ„æºä¸è¶³ï¼éœ€è¦ ${guest.needAmount} ${guest.need === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}`, "error");
                return;
            }
            
            // æ‰£é™¤èµ„æº
            if (guest.need === 'silver') {
                gameState.silver -= guest.needAmount;
            } else {
                gameState.merit -= guest.needAmount;
            }
            
            // è®¡ç®—å¥–åŠ±ï¼ˆè€ƒè™‘å¤©æ°”ï¼‰
            const weatherEffect = weatherEffects[gameState.weather];
            let finalReward = guest.rewardAmount;
            if (guest.type === "äº¡çµ" && gameState.weather === "æœˆåœ†") {
                finalReward = Math.floor(finalReward * 1.5);
            }
            
            // ç»™äºˆå¥–åŠ±
            if (guest.reward === 'silver') {
                gameState.silver += finalReward;
                showNotification(`æˆåŠŸæ‹›å¾…${guest.name}ï¼Œè·å¾—${finalReward}ç™½é“¶ï¼`, "success");
            } else {
                gameState.merit += finalReward;
                showNotification(`æˆåŠŸæ‹›å¾…${guest.name}ï¼Œè·å¾—${finalReward}åŠŸå¾·ï¼`, "success");
            }
            
            // äº¡çµæ¶ˆè€—é˜´ç±³
            if (guest.type === 'äº¡çµ') {
                gameState.rice = Math.max(0, gameState.rice - 1);
            }
            
            // ç§»é™¤å®¢äºº
            gameState.guests.splice(index, 1);
            updateDisplay();
        }

        // ä¸å®¢äººäº¤æµ
        function chatGuest(index) {
            const guest = gameState.guests[index];
            const messages = [
                `${guest.name}è¯´ï¼š"æŒæŸœçš„ç”Ÿæ„å…´éš†å•Šï¼"`,
                `ä¸${guest.name}èŠå¤©ï¼Œå¿ƒæƒ…æ„‰æ‚¦ï¼`,
                `${guest.name}è®²è¿°äº†ä¸€ä¸ªæœ‰è¶£çš„æ•…äº‹...`,
                `${guest.name}å¯¹å®¢æ ˆçš„æœåŠ¡è¡¨ç¤ºæ»¡æ„ã€‚`
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            showNotification(message, "info");
            
            // æœ‰å°æ¦‚ç‡è·å¾—å£°æœ›
            if (Math.random() > 0.7) {
                gameState.reputation += 5;
                showNotification("è·å¾—5ç‚¹å£°æœ›", "success");
                updateDisplay();
            }
        }

        // è®®ä»·
        function bargainGuest(index) {
            const guest = gameState.guests[index];
            
            if (guest.type === 'äº¡çµ') {
                showNotification("äº¡çµæ— æ³•è®®ä»·", "warning");
                return;
            }
            
            if (Math.random() > 0.5) {
                // è®®ä»·æˆåŠŸ
                const discount = Math.floor(guest.needAmount * 0.3);
                guest.needAmount = Math.max(1, guest.needAmount - discount);
                showNotification(`è®®ä»·æˆåŠŸï¼${guest.name}çš„è¦æ±‚é™ä½${discount}`, "success");
                updateDisplay();
            } else {
                // è®®ä»·å¤±è´¥
                guest.needAmount = Math.floor(guest.needAmount * 1.2);
                showNotification("è®®ä»·å¤±è´¥ï¼Œå®¢äººæœ‰äº›ä¸æ‚¦", "warning");
                updateDisplay();
            }
        }

        // æ‹’ç»å®¢äºº
        function refuseGuest(index) {
            const guest = gameState.guests[index];
            gameState.guests.splice(index, 1);
            
            if (guest.type === 'äº¡çµ' && Math.random() > 0.5) {
                gameState.reputation = Math.max(0, gameState.reputation - 10);
                showNotification(`${guest.name}è¢«æ¿€æ€’äº†ï¼å£°æœ›é™ä½10ç‚¹`, "error");
            } else {
                showNotification(`æ‹’ç»äº†${guest.name}`, "info");
            }
            
            updateDisplay();
        }

        // å¤–å‡ºæ¢ç´¢
        function explore() {
            const events = [
                {
                    name: "å‘ç°å®ç®±",
                    message: "åœ¨é‡å¤–å‘ç°äº†ä¸€ä¸ªå®ç®±ï¼",
                    reward: { type: "silver", amount: 50 }
                },
                {
                    name: "æ•‘åŠ©è·¯äºº",
                    message: "æ•‘åŠ©äº†ä¸€ä½å—ä¼¤çš„è·¯äºº",
                    reward: { type: "reputation", amount: 15 }
                },
                {
                    name: "é‡‡é›†è‰è¯",
                    message: "é‡‡é›†åˆ°çç¨€è‰è¯",
                    reward: { type: "rice", amount: 10 }
                },
                {
                    name: "é­é‡å±±è´¼",
                    message: "ä¸å¹¸é­é‡å±±è´¼ï¼ŒæŸå¤±äº†ä¸€äº›é’±è´¢",
                    reward: { type: "silver", amount: -30 }
                }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            
            // åº”ç”¨å¥–åŠ±
            if (event.reward.type === 'silver') {
                gameState.silver += event.reward.amount;
            } else if (event.reward.type === 'reputation') {
                gameState.reputation += event.reward.amount;
            } else if (event.reward.type === 'rice') {
                gameState.rice += event.reward.amount;
            }
            
            showNotification(`æ¢ç´¢ç»“æœï¼š${event.message}`, "info");
            updateDisplay();
        }

        // å®¢æ ˆå‡çº§
        function upgradeInn() {
            const upgrades = [
                { name: "æ‰©å»ºå®¢æˆ¿", cost: 50, effect: "maxGuests", value: 1 },
                { name: "æ”¹è‰¯å†œç”°", cost: 30, effect: "ricePerDay", value: 2 },
                { name: "è£…é¥°å®¢æ ˆ", cost: 40, effect: "reputation", value: 10 }
            ];
            
            let options = "è¯·é€‰æ‹©å‡çº§é¡¹ç›®ï¼š\n";
            upgrades.forEach((upgrade, index) => {
                options += `${index + 1}. ${upgrade.name} - èŠ±è´¹${upgrade.cost}ç™½é“¶\n`;
            });
            
            const choice = prompt(options + "\nè¾“å…¥ç¼–å·ï¼š");
            if (!choice) return;
            
            const index = parseInt(choice) - 1;
            if (isNaN(index) || index < 0 || index >= upgrades.length) {
                showNotification("æ— æ•ˆçš„é€‰æ‹©", "error");
                return;
            }
            
            const upgrade = upgrades[index];
            
            if (gameState.silver < upgrade.cost) {
                showNotification(`ç™½é“¶ä¸è¶³ï¼éœ€è¦${upgrade.cost}ç™½é“¶`, "error");
                return;
            }
            
            gameState.silver -= upgrade.cost;
            
            if (upgrade.effect === "maxGuests") {
                gameState.maxGuests += upgrade.value;
            } else if (upgrade.effect === "ricePerDay") {
                gameState.ricePerDay += upgrade.value;
            } else if (upgrade.effect === "reputation") {
                gameState.reputation += upgrade.value;
            }
            
            gameState.innLevel += 1;
            showNotification(`æˆåŠŸå‡çº§ï¼š${upgrade.name}`, "success");
            updateDisplay();
        }

        // ä½¿ç”¨ç¥é€š
        function useSpecialPower() {
            if (gameState.specialPower <= 0) {
                showNotification("ç¥é€šæ¬¡æ•°ä¸è¶³ï¼", "warning");
                return;
            }
            
            const powers = [
                { name: "ç‚¹çŸ³æˆé‡‘", effect: () => gameState.silver += 100 },
                { name: "åŠŸå¾·åŠ æŒ", effect: () => gameState.merit += 50 },
                { name: "é˜´ç±³ä¸°æ”¶", effect: () => gameState.rice += 20 },
                { name: "å¸å¼•å®¢äºº", effect: () => { for(let i=0; i<3; i++) generateGuest(); } }
            ];
            
            let options = "è¯·é€‰æ‹©ç¥é€šï¼š\n";
            powers.forEach((power, index) => {
                options += `${index + 1}. ${power.name}\n`;
            });
            
            const choice = prompt(options + "\nè¾“å…¥ç¼–å·ï¼š");
            if (!choice) return;
            
            const index = parseInt(choice) - 1;
            if (isNaN(index) || index < 0 || index >= powers.length) {
                showNotification("æ— æ•ˆçš„é€‰æ‹©", "error");
                return;
            }
            
            gameState.specialPower -= 1;
            powers[index].effect();
            showNotification(`ä½¿ç”¨ç¥é€šï¼š${powers[index].name}`, "success");
            updateDisplay();
        }

        // æŸ¥çœ‹æˆå°±
        function checkAchievements() {
            const achievements = [
                { name: "åˆæ¥ä¹åˆ°", desc: "æ‹›å¾…ç¬¬ä¸€ä½å®¢äºº", achieved: gameState.reputation > 0 },
                { name: "æ—¥è¿›æ–—é‡‘", desc: "å•æ—¥è·å¾—100ç™½é“¶", achieved: false },
                { name: "åŠŸå¾·æ— é‡", desc: "ç§¯ç´¯500åŠŸå¾·", achieved: gameState.merit >= 500 },
                { name: "å®¾è‡³å¦‚å½’", desc: "æ‹›å¾…10ä½å®¢äºº", achieved: false }
            ];
            
            let message = "ğŸ† æˆå°±åˆ—è¡¨ï¼š\n\n";
            achievements.forEach(ach => {
                message += `${ach.achieved ? "âœ…" : "â¬œ"} ${ach.name}\n`;
                message += `   ${ach.desc}\n\n`;
            });
            
            alert(message);
        }

        // ä¸‹ä¸€å¤©
        function nextDay() {
            gameState.day += 1;
            
            // æ¯å¤©äº§å‡ºé˜´ç±³
            gameState.rice += gameState.ricePerDay;
            
            // ç”Ÿæˆæ–°å¤©æ°”
            generateWeather();
            
            // æ¸…ç©ºæœªæ‹›å¾…çš„å®¢äºº
            if (gameState.guests.length > 0) {
                const leftCount = gameState.guests.length;
                gameState.guests.forEach(guest => {
                    if (guest.type === 'äº¡çµ') {
                        gameState.reputation = Math.max(0, gameState.reputation - 5);
                    }
                });
                gameState.guests = [];
                showNotification(`${leftCount}ä½å®¢äººç¦»å¼€äº†å®¢æ ˆ`, "warning");
            }
            
            // éšæœºäº‹ä»¶
            if (Math.random() > 0.7) {
                const events = [
                    { message: "ä»Šå¤©å®¢æ ˆç”Ÿæ„å…´éš†ï¼", effect: () => gameState.silver += 20 },
                    { message: "æœ‰å–„äººæèµ åŠŸå¾·", effect: () => gameState.merit += 15 },
                    { message: "è·å¾—ç‰¹æ®Šç‰©å“", effect: () => gameState.specialPower += 1 }
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                event.effect();
                showNotification(event.message, "info");
            }
            
            updateDisplay();
            showNotification(`è¿›å…¥ç¬¬${gameState.day}å¤©ï¼`, "success");
        }

        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('lingjingInnSave', JSON.stringify(gameState));
            showNotification("æ¸¸æˆå·²ä¿å­˜ï¼", "success");
        }

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const saveData = localStorage.getItem('lingjingInnSave');
            if (saveData) {
                gameState = JSON.parse(saveData);
                updateDisplay();
                showNotification("æ¸¸æˆå·²åŠ è½½ï¼", "success");
            } else {
                showNotification("æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„æ¸¸æˆï¼", "error");
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            if (confirm("ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦éƒ½ä¼šä¸¢å¤±ï¼")) {
                gameState = {
                    silver: 100,
                    merit: 100,
                    rice: 20,
                    reputation: 0,
                    day: 1,
                    weather: "æ™´æœ—",
                    guests: [],
                    innLevel: 1,
                    maxGuests: 3,
                    ricePerDay: 5,
                    specialPower: 3,
                    achievements: []
                };
                updateDisplay();
                showNotification("æ¸¸æˆå·²é‡ç½®ï¼", "success");
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹
        window.onload = startLoading;
        
        // ç›‘å¬æ¨ªç«–å±å˜åŒ–
        window.addEventListener("orientationchange", function() {
            if (window.orientation === 90 || window.orientation === -90) {
                // æ¨ªå±
                document.body.style.transform = "rotate(0deg)";
            } else {
                // ç«–å± - æ˜¾ç¤ºæç¤º
                if (document.getElementById('game').style.display !== 'none') {
                    alert("è¯·å°†æ‰‹æœºæ¨ªå±ä»¥è·å¾—æœ€ä½³æ¸¸æˆä½“éªŒï¼");
                }
            }
        });
    </script>
</body>
</html>