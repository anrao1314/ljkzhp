<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="çµå¢ƒå®¢æ ˆ">
    <meta name="mobile-web-app-capable" content="yes">
    
    <title>çµå¢ƒå®¢æ ˆ</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            color: #e6e6e6;
            font-family: 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-logo {
            font-size: 60px;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .progress-container {
            width: 200px;
            height: 15px;
            background-color: #333;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        #progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 8px;
            transition: width 0.3s;
        }
        
        #loading-text {
            font-size: 16px;
            margin-top: 15px;
        }
        
        #game {
            display: none;
            width: 100%;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        
        .game-title {
            font-size: 24px;
            color: #FFD700;
            margin-bottom: 5px;
        }
        
        .day-info {
            font-size: 18px;
            color: #87CEEB;
        }
        
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .resource-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 1px solid #555;
        }
        
        .resource-name {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .resource-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .silver { color: #C0C0C0; }
        .merit { color: #FFD700; }
        .rice { color: #98FB98; }
        .reputation { color: #9370DB; }
        
        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 4px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #F44336, #D32F2F);
        }
        
        .btn-special {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
        }
        
        .btn-group {
            margin: 12px 0;
        }
        
        .btn-group-title {
            font-size: 16px;
            color: #FFD700;
            margin-bottom: 8px;
            padding-left: 8px;
            border-left: 2px solid #FFD700;
        }
        
        .btn-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .guest-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #555;
        }
        
        .guest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .guest-name {
            font-size: 16px;
            color: #FFD700;
            font-weight: bold;
        }
        
        .guest-type {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .type-live { background: #2E8B57; }
        .type-ghost { background: #8B008B; }
        
        .guest-desc {
            font-size: 13px;
            color: #ccc;
            margin: 5px 0;
            font-style: italic;
        }
        
        .guest-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 10px 0;
        }
        
        .need-box, .reward-box {
            padding: 6px;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
        }
        
        .need-box {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #FF6B6B;
        }
        
        .reward-box {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ECDC4;
        }
        
        .guest-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        
        .guest-actions .btn {
            padding: 6px;
            font-size: 12px;
            margin: 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: #888;
            display: none;
        }
        
        .empty-state-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            animation: slideUp 0.3s, fadeOut 0.3s 2.7s;
            display: none;
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @media (max-width: 768px) {
            .resources-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="loading-logo">ğŸ®</div>
        <h3>çµå¢ƒå®¢æ ˆ</h3>
        <div class="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div id="loading-text">æ­£åœ¨è¿æ¥é˜´é˜³ä¸¤ç•Œ...</div>
    </div>

    <div id="game">
        <div class="game-header">
            <div class="game-title">ğŸ® çµå¢ƒå®¢æ ˆ</div>
            <div class="day-info">ç¬¬ <span id="current-day">1</span> å¤©</div>
        </div>
        
        <div class="resources-grid">
            <div class="resource-item">
                <div class="resource-name">ç™½é“¶</div>
                <div id="silver-value" class="resource-value silver">100</div>
            </div>
            <div class="resource-item">
                <div class="resource-name">åŠŸå¾·</div>
                <div id="merit-value" class="resource-value merit">100</div>
            </div>
            <div class="resource-item">
                <div class="resource-name">é˜´ç±³</div>
                <div id="rice-value" class="resource-value rice">20</div>
            </div>
            <div class="resource-item">
                <div class="resource-name">å£°æœ›</div>
                <div id="reputation-value" class="resource-value reputation">0</div>
            </div>
        </div>
        
        <div class="btn-group">
            <div class="btn-group-title">å®¢æ ˆæ“ä½œ</div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="generateGuest()">å¬å”¤å®¢äºº</button>
                <button class="btn btn-warning" onclick="explore()">å¤–å‡ºæ¢ç´¢</button>
            </div>
            <div class="btn-row">
                <button class="btn btn-special" onclick="nextDay()">ä¸‹ä¸€å¤©</button>
                <button class="btn" onclick="upgradeInn()">å®¢æ ˆå‡çº§</button>
            </div>
        </div>
        
        <div id="guests-section">
            <div class="btn-group-title">å½“å‰å®¢äºº</div>
            
            <!-- ç©ºçŠ¶æ€æç¤º -->
            <div class="empty-state" id="empty-guests">
                <div class="empty-state-icon">ğŸ‘¥</div>
                <div>æš‚æ— å®¢äºº</div>
                <div style="font-size: 12px; margin-top: 5px;">ç‚¹å‡»"å¬å”¤å®¢äºº"æŒ‰é’®å¬å”¤</div>
            </div>
            
            <!-- å®¢äººåˆ—è¡¨å®¹å™¨ -->
            <div id="guests-list"></div>
        </div>
        
        <div class="btn-group">
            <div class="btn-group-title">å…¶ä»–åŠŸèƒ½</div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="saveGame()">ä¿å­˜</button>
                <button class="btn btn-warning" onclick="loadGame()">åŠ è½½</button>
                <button class="btn btn-danger" onclick="resetGame()">é‡ç½®</button>
                <button class="btn btn-special" onclick="checkAchievements()">æˆå°±</button>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            silver: 100,
            merit: 100,
            rice: 20,
            reputation: 0,
            day: 1,
            guests: [],
            innLevel: 1,
            maxGuests: 3,
            ricePerDay: 5
        };

        // å®¢äººæ•°æ®
        const guestTypes = [
            { name: "ä¹¦ç”Ÿ", type: "æ´»äºº", desc: "èµ´äº¬èµ¶è€ƒçš„ä¹¦ç”Ÿ", need: "silver", needAmount: 3, reward: "silver", rewardAmount: 8 },
            { name: "å•†äºº", type: "æ´»äºº", desc: "è¥¿åŸŸæ¥çš„èƒ¡å•†", need: "silver", needAmount: 8, reward: "silver", rewardAmount: 15 },
            { name: "ä¾ å®¢", type: "æ´»äºº", desc: "è¡Œèµ°æ±Ÿæ¹–çš„å‰‘å®¢", need: "silver", needAmount: 5, reward: "silver", rewardAmount: 10 },
            { name: "å®˜å‘˜", type: "æ´»äºº", desc: "å¾®æœç§è®¿çš„å®˜å‘˜", need: "silver", needAmount: 12, reward: "silver", rewardAmount: 25 },
            { name: "å†œå¤«", type: "æ´»äºº", desc: "è¿›åŸå–èœçš„å†œæ°‘", need: "silver", needAmount: 2, reward: "silver", rewardAmount: 5 },
            { name: "å’Œå°š", type: "æ´»äºº", desc: "åŒ–ç¼˜çš„åƒ§äºº", need: "silver", needAmount: 1, reward: "merit", rewardAmount: 3 },
            { name: "åŒ»ç”Ÿ", type: "æ´»äºº", desc: "é‡‡è¯çš„éƒä¸­", need: "silver", needAmount: 4, reward: "silver", rewardAmount: 9 },
            { name: "æ­Œå¥³", type: "æ´»äºº", desc: "å–è‰ºçš„æ­Œå§¬", need: "silver", needAmount: 6, reward: "silver", rewardAmount: 13 },
            { name: "é¥¿æ­»é¬¼", type: "äº¡çµ", desc: "é¥¥é¥¿çš„äº¡çµ", need: "merit", needAmount: 2, reward: "merit", rewardAmount: 5 },
            { name: "æ°´é¬¼", type: "äº¡çµ", desc: "æººæ°´çš„é­‚é­„", need: "merit", needAmount: 3, reward: "merit", rewardAmount: 7 },
            { name: "åŠæ­»é¬¼", type: "äº¡çµ", desc: "ä¸ŠåŠçš„äº¡çµ", need: "merit", needAmount: 4, reward: "merit", rewardAmount: 9 },
            { name: "æ— å¤´é¬¼", type: "äº¡çµ", desc: "æ²¡æœ‰å¤´çš„äº¡çµ", need: "merit", needAmount: 6, reward: "merit", rewardAmount: 12 },
            { name: "å†¤æ­»é¬¼", type: "äº¡çµ", desc: "å«å†¤è€Œæ­»çš„é­‚é­„", need: "merit", needAmount: 5, reward: "merit", rewardAmount: 11 },
            { name: "ç—…é¬¼", type: "äº¡çµ", desc: "ç—…æ­»çš„äº¡çµ", need: "merit", needAmount: 3, reward: "merit", rewardAmount: 6 },
            { name: "æˆ˜é¬¼", type: "äº¡çµ", desc: "æˆ˜æ­»çš„å£«å…µ", need: "merit", needAmount: 7, reward: "merit", rewardAmount: 15 },
            { name: "å©´çµ", type: "äº¡çµ", desc: "å¤­æŠ˜çš„å©´å„¿é­‚é­„", need: "merit", needAmount: 1, reward: "merit", rewardAmount: 4 }
        ];

        // åŠ è½½åŠ¨ç”»
        function startLoading() {
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 2;
                progressBar.style.width = progress + '%';
                
                if (progress <= 30) loadingText.textContent = "æ­£åœ¨è¿æ¥é˜´é˜³ä¸¤ç•Œ...";
                else if (progress <= 60) loadingText.textContent = "åŠ è½½å®¢äººæ•°æ®...";
                else if (progress <= 90) loadingText.textContent = "åˆå§‹åŒ–å®¢æ ˆç³»ç»Ÿ...";
                else loadingText.textContent = "å‡†å¤‡è¿æ¥å®¢äºº...";
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(finishLoading, 300);
                }
            }, 50);
        }

        // å®ŒæˆåŠ è½½
        function finishLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            updateDisplay();
            showNotification("æ¬¢è¿æ¥åˆ°çµå¢ƒå®¢æ ˆï¼");
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            // æ›´æ–°èµ„æº
            document.getElementById('silver-value').textContent = gameState.silver;
            document.getElementById('merit-value').textContent = gameState.merit;
            document.getElementById('rice-value').textContent = gameState.rice;
            document.getElementById('reputation-value').textContent = gameState.reputation;
            
            // æ›´æ–°å¤©æ•°
            document.getElementById('current-day').textContent = gameState.day;
            
            // æ›´æ–°å®¢äººåˆ—è¡¨
            displayGuests();
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = "info") {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            const colors = {
                success: "linear-gradient(135deg, #4CAF50, #45a049)",
                warning: "linear-gradient(135deg, #FF9800, #F57C00)",
                error: "linear-gradient(135deg, #F44336, #D32F2F)",
                info: "linear-gradient(135deg, #2196F3, #1976D2)"
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // æ˜¾ç¤ºå®¢äºº - ä¿®å¤ç‰ˆï¼è¿™æ˜¯å…³é”®
        function displayGuests() {
            const emptyGuests = document.getElementById('empty-guests');
            const guestsList = document.getElementById('guests-list');
            
            // å…ˆæ¸…ç©ºå®¢äººåˆ—è¡¨
            guestsList.innerHTML = '';
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å®¢äºº
            if (gameState.guests.length === 0) {
                // æ²¡æœ‰å®¢äººï¼šæ˜¾ç¤ºç©ºçŠ¶æ€ï¼Œéšè—åˆ—è¡¨
                emptyGuests.style.display = 'block';
                return;
            }
            
            // æœ‰å®¢äººï¼šéšè—ç©ºçŠ¶æ€ï¼Œæ˜¾ç¤ºå®¢äººåˆ—è¡¨
            emptyGuests.style.display = 'none';
            
            // é‡æ–°ç”Ÿæˆæ‰€æœ‰å®¢äººå¡ç‰‡
            gameState.guests.forEach((guest, index) => {
                const guestCard = document.createElement('div');
                guestCard.className = 'guest-card';
                guestCard.dataset.index = index;
                
                guestCard.innerHTML = `
                    <div class="guest-header">
                        <div class="guest-name">${guest.name}</div>
                        <div class="guest-type ${guest.type === 'æ´»äºº' ? 'type-live' : 'type-ghost'}">
                            ${guest.type}
                        </div>
                    </div>
                    <div class="guest-desc">${guest.desc}</div>
                    <div class="guest-stats">
                        <div class="need-box">
                            <div>éœ€è¦</div>
                            <div style="font-size: 14px; color: #FF6B6B; margin-top: 3px;">
                                ${guest.needAmount} ${guest.need === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}
                            </div>
                        </div>
                        <div class="reward-box">
                            <div>å¥–åŠ±</div>
                            <div style="font-size: 14px; color: #4ECDC4; margin-top: 3px;">
                                ${guest.rewardAmount} ${guest.reward === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}
                            </div>
                        </div>
                    </div>
                    <div class="guest-actions">
                        <button class="btn btn-primary" onclick="serveGuest(${index})" ${canServe(guest) ? '' : 'disabled'}>
                            æ‹›å¾…
                        </button>
                        <button class="btn" onclick="chatGuest(${index})">
                            äº¤æµ
                        </button>
                        <button class="btn" onclick="bargainGuest(${index})" ${guest.type === 'äº¡çµ' ? 'disabled' : ''}>
                            è®®ä»·
                        </button>
                        <button class="btn btn-danger" onclick="refuseGuest(${index})">
                            æ‹’ç»
                        </button>
                    </div>
                `;
                
                guestsList.appendChild(guestCard);
            });
        }

        // æ£€æŸ¥æ˜¯å¦èƒ½æ‹›å¾…
        function canServe(guest) {
            if (guest.need === 'silver') {
                return gameState.silver >= guest.needAmount;
            } else {
                return gameState.merit >= guest.needAmount;
            }
        }

        // å¬å”¤å®¢äºº
        function generateGuest() {
            if (gameState.guests.length >= gameState.maxGuests) {
                showNotification(`å®¢æ ˆå·²æ»¡ï¼æœ€å¤šåªèƒ½æœ‰ ${gameState.maxGuests} ä½å®¢äººã€‚`, "warning");
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * guestTypes.length);
            const guest = { ...guestTypes[randomIndex], id: Date.now() };
            
            gameState.guests.push(guest);
            updateDisplay();
            showNotification(`${guest.name}æ¥åˆ°äº†å®¢æ ˆ`, "success");
        }

        // æ‹›å¾…å®¢äºº
        function serveGuest(index) {
            const guest = gameState.guests[index];
            
            if (!canServe(guest)) {
                showNotification(`èµ„æºä¸è¶³ï¼éœ€è¦ ${guest.needAmount} ${guest.need === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}`, "error");
                return;
            }
            
            // æ‰£é™¤èµ„æº
            if (guest.need === 'silver') {
                gameState.silver -= guest.needAmount;
            } else {
                gameState.merit -= guest.needAmount;
            }
            
            // ç»™äºˆå¥–åŠ±
            if (guest.reward === 'silver') {
                gameState.silver += guest.rewardAmount;
                showNotification(`æˆåŠŸæ‹›å¾…${guest.name}ï¼Œè·å¾—${guest.rewardAmount}ç™½é“¶ï¼`, "success");
            } else {
                gameState.merit += guest.rewardAmount;
                showNotification(`æˆåŠŸæ‹›å¾…${guest.name}ï¼Œè·å¾—${guest.rewardAmount}åŠŸå¾·ï¼`, "success");
            }
            
            // äº¡çµæ¶ˆè€—é˜´ç±³
            if (guest.type === 'äº¡çµ') {
                gameState.rice = Math.max(0, gameState.rice - 1);
            }
            
            // å¢åŠ å£°æœ›
            gameState.reputation += 5;
            
            // ç§»é™¤å®¢äºº
            gameState.guests.splice(index, 1);
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();
        }

        // ä¸å®¢äººäº¤æµ
        function chatGuest(index) {
            const guest = gameState.guests[index];
            const messages = [
                `${guest.name}è¯´ï¼š"æŒæŸœçš„ç”Ÿæ„å…´éš†ï¼"`,
                `ä¸${guest.name}èŠå¤©ï¼Œå¿ƒæƒ…æ„‰æ‚¦ï¼`,
                `${guest.name}è®²è¿°äº†ä¸€ä¸ªæœ‰è¶£çš„æ•…äº‹...`
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            showNotification(message, "info");
        }

        // è®®ä»·
        function bargainGuest(index) {
            const guest = gameState.guests[index];
            
            if (guest.type === 'äº¡çµ') {
                showNotification("äº¡çµæ— æ³•è®®ä»·", "warning");
                return;
            }
            
            if (Math.random() > 0.5) {
                const discount = Math.floor(guest.needAmount * 0.2);
                guest.needAmount = Math.max(1, guest.needAmount - discount);
                showNotification(`è®®ä»·æˆåŠŸï¼è¦æ±‚é™ä½${discount}`, "success");
                updateDisplay();
            } else {
                showNotification("è®®ä»·å¤±è´¥", "warning");
            }
        }

        // æ‹’ç»å®¢äºº
        function refuseGuest(index) {
            const guest = gameState.guests[index];
            gameState.guests.splice(index, 1);
            updateDisplay();
            showNotification(`æ‹’ç»äº†${guest.name}`);
        }

        // å¤–å‡ºæ¢ç´¢
        function explore() {
            const events = [
                { message: "å‘ç°å®ç®±ï¼Œè·å¾—50ç™½é“¶ï¼", reward: () => gameState.silver += 50 },
                { message: "æ•‘åŠ©è·¯äººï¼Œè·å¾—15å£°æœ›", reward: () => gameState.reputation += 15 },
                { message: "é‡‡é›†è‰è¯ï¼Œè·å¾—10é˜´ç±³", reward: () => gameState.rice += 10 },
                { message: "é­é‡å±±è´¼ï¼ŒæŸå¤±30ç™½é“¶", reward: () => gameState.silver = Math.max(0, gameState.silver - 30) }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            event.reward();
            showNotification(event.message, "info");
            updateDisplay();
        }

        // å®¢æ ˆå‡çº§
        function upgradeInn() {
            if (gameState.silver < 50) {
                showNotification("éœ€è¦50ç™½é“¶æ‰èƒ½å‡çº§ï¼", "error");
                return;
            }
            
            const options = ["æœ€å¤§å®¢äºº+1", "é˜´ç±³äº§å‡º+2/å¤©", "å£°æœ›+10"];
            const choice = prompt(`é€‰æ‹©å‡çº§é¡¹ç›®ï¼ˆèŠ±è´¹50ç™½é“¶ï¼‰ï¼š\n1. ${options[0]}\n2. ${options[1]}\n3. ${options[2]}\n\nè¾“å…¥ç¼–å·ï¼š`);
            
            if (!choice) return;
            
            const index = parseInt(choice) - 1;
            if (isNaN(index) || index < 0 || index >= options.length) {
                showNotification("æ— æ•ˆçš„é€‰æ‹©", "error");
                return;
            }
            
            gameState.silver -= 50;
            gameState.innLevel += 1;
            
            if (index === 0) {
                gameState.maxGuests += 1;
                showNotification("æ‰©å»ºå®¢æˆ¿å®Œæˆï¼æœ€å¤§å®¢äºº+1", "success");
            } else if (index === 1) {
                gameState.ricePerDay += 2;
                showNotification("æ”¹è‰¯å†œç”°å®Œæˆï¼é˜´ç±³äº§å‡º+2/å¤©", "success");
            } else if (index === 2) {
                gameState.reputation += 10;
                showNotification("è£…é¥°å®¢æ ˆå®Œæˆï¼å£°æœ›+10", "success");
            }
            
            updateDisplay();
        }

        // ä¸‹ä¸€å¤©
        function nextDay() {
            gameState.day += 1;
            gameState.rice += gameState.ricePerDay;
            
            // æ¸…ç©ºæœªæ‹›å¾…çš„å®¢äºº
            if (gameState.guests.length > 0) {
                gameState.guests = [];
                showNotification("æ–°çš„ä¸€å¤©å¼€å§‹ï¼Œæ˜¨æ—¥å®¢äººå·²ç¦»å¼€", "warning");
            }
            
            // éšæœºäº‹ä»¶
            if (Math.random() > 0.7) {
                gameState.silver += 20;
                showNotification("ä»Šå¤©å®¢æ ˆç”Ÿæ„å…´éš†ï¼è·å¾—20ç™½é“¶", "success");
            }
            
            updateDisplay();
            showNotification(`è¿›å…¥ç¬¬${gameState.day}å¤©ï¼`, "success");
        }

        // æŸ¥çœ‹æˆå°±
        function checkAchievements() {
            const achievements = [
                { name: "åˆæ¥ä¹åˆ°", desc: "æ‹›å¾…ç¬¬ä¸€ä½å®¢äºº", done: gameState.reputation > 0 },
                { name: "åŠŸå¾·æ— é‡", desc: "ç§¯ç´¯500åŠŸå¾·", done: gameState.merit >= 500 },
                { name: "å¯Œå¯æ•Œå›½", desc: "æ‹¥æœ‰1000ç™½é“¶", done: gameState.silver >= 1000 },
                { name: "å®¢æ ˆå¤§å¸ˆ", desc: "å®¢æ ˆè¾¾åˆ°5çº§", done: gameState.innLevel >= 5 }
            ];
            
            let message = "ğŸ† æˆå°±åˆ—è¡¨ï¼š\n\n";
            achievements.forEach(ach => {
                message += `${ach.done ? "âœ…" : "â¬œ"} ${ach.name}\n`;
                message += `   ${ach.desc}\n\n`;
            });
            
            alert(message);
        }

        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('lingjingInnSave', JSON.stringify(gameState));
            showNotification("æ¸¸æˆå·²ä¿å­˜ï¼", "success");
        }

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const saveData = localStorage.getItem('lingjingInnSave');
            if (saveData) {
                gameState = JSON.parse(saveData);
                updateDisplay();
                showNotification("æ¸¸æˆå·²åŠ è½½ï¼", "success");
            } else {
                showNotification("æ²¡æœ‰ä¿å­˜çš„æ¸¸æˆï¼", "error");
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            if (confirm("ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦éƒ½ä¼šä¸¢å¤±ï¼")) {
                gameState = {
                    silver: 100,
                    merit: 100,
                    rice: 20,
                    reputation: 0,
                    day: 1,
                    guests: [],
                    innLevel: 1,
                    maxGuests: 3,
                    ricePerDay: 5
                };
                updateDisplay();
                showNotification("æ¸¸æˆå·²é‡ç½®ï¼", "success");
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹
        window.onload = startLoading;
    </script>
</body>
</html>
