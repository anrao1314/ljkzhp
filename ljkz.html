<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="çµå¢ƒå®¢æ ˆ">
    <meta name="mobile-web-app-capable" content="yes">
    
    <title>çµå¢ƒå®¢æ ˆ</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            color: #e6e6e6;
            font-family: 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-logo {
            font-size: 60px;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .progress-container {
            width: 200px;
            height: 15px;
            background-color: #333;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        #progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 8px;
            transition: width 0.3s;
        }
        
        #loading-text {
            font-size: 16px;
            margin-top: 15px;
        }
        
        #game {
            display: none;
            width: 100%;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        
        .game-title {
            font-size: 24px;
            color: #FFD700;
            margin-bottom: 5px;
        }
        
        .day-info {
            font-size: 18px;
            color: #87CEEB;
        }
        
        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        .music-control {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
            font-size: 20px;
        }
        
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .resource-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 1px solid #555;
        }
        
        .resource-name {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .resource-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .silver { color: #C0C0C0; }
        .merit { color: #FFD700; }
        .rice { color: #98FB98; }
        .reputation { color: #9370DB; }
        
        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 4px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #F44336, #D32F2F);
        }
        
        .btn-special {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
        }
        
        .btn-group {
            margin: 12px 0;
        }
        
        .btn-group-title {
            font-size: 16px;
            color: #FFD700;
            margin-bottom: 8px;
            padding-left: 8px;
            border-left: 2px solid #FFD700;
        }
        
        .btn-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }
        
        /* ç‰¹æ®Šå®¢äººæ ·å¼ */
        .special-guest {
            border: 2px solid #FFD700 !important;
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05)) !important;
            position: relative;
            overflow: hidden;
        }
        
        .special-guest::before {
            content: "âœ¨";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 20px;
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .guest-rarity {
            font-size: 11px;
            padding: 1px 6px;
            border-radius: 4px;
            margin-left: 8px;
            font-weight: bold;
        }
        
        .legendary {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
        }
        
        .rare {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
            color: white;
        }
        
        .guest-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #555;
        }
        
        .guest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .guest-name {
            font-size: 16px;
            color: #FFD700;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .guest-type {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .type-live { background: #2E8B57; }
        .type-ghost { background: #8B008B; }
        .type-god { background: #FFD700; color: #000; }
        .type-monster { background: #FF4500; }
        
        .guest-desc {
            font-size: 13px;
            color: #ccc;
            margin: 5px 0;
            font-style: italic;
        }
        
        .special-effect {
            color: #9370DB;
            font-size: 12px;
            margin: 3px 0;
        }
        
        .guest-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 10px 0;
        }
        
        .need-box, .reward-box {
            padding: 6px;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
        }
        
        .need-box {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #FF6B6B;
        }
        
        .reward-box {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ECDC4;
        }
        
        .guest-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        
        .guest-actions .btn {
            padding: 6px;
            font-size: 12px;
            margin: 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: #888;
            display: none;
        }
        
        .empty-state-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            animation: slideUp 0.3s, fadeOut 0.3s 2.7s;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @media (max-width: 768px) {
            .resources-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div class="music-control" id="music-toggle" onclick="toggleMusic()">ğŸµ</div>
    
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="loading">
        <div class="loading-logo">ğŸ®</div>
        <h3>çµå¢ƒå®¢æ ˆ</h3>
        <div class="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div id="loading-text">æ­£åœ¨è¿æ¥é˜´é˜³ä¸¤ç•Œ...</div>
    </div>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game">
        <div class="game-header">
            <div class="game-title">ğŸ® çµå¢ƒå®¢æ ˆ</div>
            <div class="day-info">ç¬¬ <span id="current-day">1</span> å¤©</div>
        </div>
        
        <!-- èµ„æºæ˜¾ç¤º -->
        <div class="resources-grid">
            <div class="resource-item">
                <div class="resource-name">ç™½é“¶</div>
                <div id="silver-value" class="resource-value silver">100</div>
            </div>
            <div class="resource-item">
                <div class="resource-name">åŠŸå¾·</div>
                <div id="merit-value" class="resource-value merit">100</div>
            </div>
            <div class="resource-item">
                <div class="resource-name">é˜´ç±³</div>
                <div id="rice-value" class="resource-value rice">20</div>
            </div>
            <div class="resource-item">
                <div class="resource-name">å£°æœ›</div>
                <div id="reputation-value" class="resource-value reputation">0</div>
            </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="btn-group">
            <div class="btn-group-title">å®¢æ ˆæ“ä½œ</div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="generateGuest()">å¬å”¤å®¢äºº</button>
                <button class="btn btn-warning" onclick="explore()">å¤–å‡ºæ¢ç´¢</button>
            </div>
            <div class="btn-row">
                <button class="btn btn-special" onclick="nextDay()">ä¸‹ä¸€å¤©</button>
                <button class="btn" onclick="upgradeInn()">å®¢æ ˆå‡çº§</button>
                <button class="btn btn-special" onclick="useSpecialItem()" style="grid-column: span 2;">ä½¿ç”¨ç‰¹æ®Šç‰©å“</button>
            </div>
        </div>
        
        <!-- å®¢äººåŒºåŸŸ -->
        <div id="guests-section">
            <div class="btn-group-title">å½“å‰å®¢äºº</div>
            
            <!-- ç©ºçŠ¶æ€æç¤º -->
            <div class="empty-state" id="empty-guests">
                <div class="empty-state-icon">ğŸ‘¥</div>
                <div>æš‚æ— å®¢äºº</div>
                <div style="font-size: 12px; margin-top: 5px;">ç‚¹å‡»"å¬å”¤å®¢äºº"æŒ‰é’®å¬å”¤</div>
            </div>
            
            <!-- å®¢äººåˆ—è¡¨å®¹å™¨ -->
            <div id="guests-list"></div>
        </div>
        
        <!-- å…¶ä»–åŠŸèƒ½ -->
        <div class="btn-group">
            <div class="btn-group-title">å…¶ä»–åŠŸèƒ½</div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="saveGame()">ä¿å­˜</button>
                <button class="btn btn-warning" onclick="loadGame()">åŠ è½½</button>
                <button class="btn btn-danger" onclick="resetGame()">é‡ç½®</button>
                <button class="btn btn-special" onclick="checkAchievements()">æˆå°±</button>
            </div>
        </div>
    </div>
    
    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification"></div>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bg-music" loop>
        <source src="https://m.kugou.com/share/song.html?chain=6h9J147FXV2" type="audio/mpeg">
    </audio>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            silver: 100,
            merit: 100,
            rice: 20,
            reputation: 0,
            day: 1,
            guests: [],
            innLevel: 1,
            maxGuests: 3,
            ricePerDay: 5,
            specialItems: [],
            musicEnabled: true
        };

        // æ™®é€šå®¢äººæ•°æ®
        const guestTypes = [
            { name: "ä¹¦ç”Ÿ", type: "æ´»äºº", desc: "èµ´äº¬èµ¶è€ƒçš„ä¹¦ç”Ÿ", need: "silver", needAmount: 3, reward: "silver", rewardAmount: 8 },
            { name: "å•†äºº", type: "æ´»äºº", desc: "è¥¿åŸŸæ¥çš„èƒ¡å•†", need: "silver", needAmount: 8, reward: "silver", rewardAmount: 15 },
            { name: "ä¾ å®¢", type: "æ´»äºº", desc: "è¡Œèµ°æ±Ÿæ¹–çš„å‰‘å®¢", need: "silver", needAmount: 5, reward: "silver", rewardAmount: 10 },
            { name: "å®˜å‘˜", type: "æ´»äºº", desc: "å¾®æœç§è®¿çš„å®˜å‘˜", need: "silver", needAmount: 12, reward: "silver", rewardAmount: 25 },
            { name: "å†œå¤«", type: "æ´»äºº", desc: "è¿›åŸå–èœçš„å†œæ°‘", need: "silver", needAmount: 2, reward: "silver", rewardAmount: 5 },
            { name: "å’Œå°š", type: "æ´»äºº", desc: "åŒ–ç¼˜çš„åƒ§äºº", need: "silver", needAmount: 1, reward: "merit", rewardAmount: 3 },
            { name: "åŒ»ç”Ÿ", type: "æ´»äºº", desc: "é‡‡è¯çš„éƒä¸­", need: "silver", needAmount: 4, reward: "silver", rewardAmount: 9 },
            { name: "æ­Œå¥³", type: "æ´»äºº", desc: "å–è‰ºçš„æ­Œå§¬", need: "silver", needAmount: 6, reward: "silver", rewardAmount: 13 },
            { name: "é¥¿æ­»é¬¼", type: "äº¡çµ", desc: "é¥¥é¥¿çš„äº¡çµ", need: "merit", needAmount: 2, reward: "merit", rewardAmount: 5 },
            { name: "æ°´é¬¼", type: "äº¡çµ", desc: "æººæ°´çš„é­‚é­„", need: "merit", needAmount: 3, reward: "merit", rewardAmount: 7 },
            { name: "åŠæ­»é¬¼", type: "äº¡çµ", desc: "ä¸ŠåŠçš„äº¡çµ", need: "merit", needAmount: 4, reward: "merit", rewardAmount: 9 },
            { name: "æ— å¤´é¬¼", type: "äº¡çµ", desc: "æ²¡æœ‰å¤´çš„äº¡çµ", need: "merit", needAmount: 6, reward: "merit", rewardAmount: 12 },
            { name: "å†¤æ­»é¬¼", type: "äº¡çµ", desc: "å«å†¤è€Œæ­»çš„é­‚é­„", need: "merit", needAmount: 5, reward: "merit", rewardAmount: 11 },
            { name: "ç—…é¬¼", type: "äº¡çµ", desc: "ç—…æ­»çš„äº¡çµ", need: "merit", needAmount: 3, reward: "merit", rewardAmount: 6 },
            { name: "æˆ˜é¬¼", type: "äº¡çµ", desc: "æˆ˜æ­»çš„å£«å…µ", need: "merit", needAmount: 7, reward: "merit", rewardAmount: 15 },
            { name: "å©´çµ", type: "äº¡çµ", desc: "å¤­æŠ˜çš„å©´å„¿é­‚é­„", need: "merit", needAmount: 1, reward: "merit", rewardAmount: 4 }
        ];

        // ç‰¹æ®Šå®¢äººæ•°æ®
        const specialGuests = [
            {
                name: "å­Ÿå©†",
                type: "é¬¼ç¥",
                desc: "æ¥è‡ªé˜´é—´çš„ä½¿è€…ï¼ŒæŒç®¡è½®å›",
                need: "merit",
                needAmount: 30,
                reward: "silver",
                rewardAmount: 100,
                special: "èµ é€å­Ÿå©†æ±¤ï¼ˆ+50åŠŸå¾·ï¼‰",
                rarity: "ä¼ è¯´"
            },
            {
                name: "è´¢ç¥",
                type: "ç¥ä»™", 
                desc: "æŒç®¡è´¢è¿çš„ç¥ä»™ï¼Œè´¢è¿äº¨é€š",
                need: "silver",
                needAmount: 50,
                reward: "silver",
                rewardAmount: 200,
                special: "è´¢è¿ç¥ç¦ï¼ˆä¸‹ä¸€å¤©æ”¶å…¥ç¿»å€ï¼‰",
                rarity: "ä¼ è¯´"
            },
            {
                name: "é»‘ç™½æ— å¸¸",
                type: "é¬¼ç¥",
                desc: "å‹¾é­‚ä½¿è€…ï¼Œé˜´æ°”æ£®æ£®",
                need: "merit",
                needAmount: 40,
                reward: "merit",
                rewardAmount: 80,
                special: "æ‹˜é­‚ç´¢ï¼ˆå¯æ‹˜ç¦ä¸€ä¸ªæ¶é¬¼ï¼‰",
                rarity: "ç¨€æœ‰"
            },
            {
                name: "ç‹ä»™",
                type: "å¦–æ€ª",
                desc: "ä¿®ç‚¼åƒå¹´çš„ç‹ç‹¸ç²¾ï¼Œå¦©åªšåŠ¨äºº",
                need: "silver",
                needAmount: 25,
                reward: "reputation",
                rewardAmount: 50,
                special: "é­…æƒ‘ä¹‹æœ¯ï¼ˆæé«˜åç»­å®¢äººå‡ºç°ç‡ï¼‰",
                rarity: "ç¨€æœ‰"
            },
            {
                name: "åœŸåœ°å…¬",
                type: "ç¥ä»™",
                desc: "æœ¬åœ°å®ˆæŠ¤ç¥ï¼Œæ…ˆçœ‰å–„ç›®",
                need: "merit",
                needAmount: 15,
                reward: "rice",
                rewardAmount: 30,
                special: "åœŸåœ°ç¥ç¦ï¼ˆé˜´ç±³äº§é‡æ°¸ä¹…+2ï¼‰",
                rarity: "ç¨€æœ‰"
            },
            {
                name: "é’Ÿé¦—",
                type: "é¬¼ç¥",
                desc: "æ‰é¬¼å¤©å¸ˆï¼Œæ­£æ°”å‡›ç„¶",
                need: "merit",
                needAmount: 35,
                reward: "special",
                rewardAmount: "æ–©é¬¼å‰‘",
                special: "æ–©å¦–é™¤é­”ï¼ˆç«‹å³è·å¾—100åŠŸå¾·ï¼‰",
                rarity: "ä¼ è¯´"
            },
            {
                name: "èŠ±é­",
                type: "æ´»äºº",
                desc: "é£åç»ä»£çš„èŠ±æ¥¼å¤´ç‰Œ",
                need: "silver",
                needAmount: 40,
                reward: "silver",
                rewardAmount: 80,
                special: "å€¾åŸä¸€ç¬‘ï¼ˆå£°æœ›+30ï¼‰",
                rarity: "ç¨€æœ‰"
            },
            {
                name: "é…’ä»™",
                type: "å¦–æ€ª",
                desc: "å¥½é…’å¦‚å‘½çš„é…’ä¸­ä»™",
                need: "silver",
                needAmount: 20,
                reward: "special",
                rewardAmount: "ä»™é…’",
                special: "é†‰é…’å½“æ­Œï¼ˆéšæœºå¢åŠ ä¸€ç§èµ„æºï¼‰",
                rarity: "ç¨€æœ‰"
            }
        ];

        // éŸ³ä¹æ§åˆ¶
        function toggleMusic() {
            const music = document.getElementById('bg-music');
            const toggleBtn = document.getElementById('music-toggle');
            
            gameState.musicEnabled = !gameState.musicEnabled;
            
            if (gameState.musicEnabled) {
                music.play().catch(e => console.log("éŸ³ä¹æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’"));
                toggleBtn.textContent = "ğŸµ";
                showNotification("èƒŒæ™¯éŸ³ä¹å·²å¼€å¯", "info");
            } else {
                music.pause();
                toggleBtn.textContent = "ğŸ”‡";
                showNotification("èƒŒæ™¯éŸ³ä¹å·²å…³é—­", "info");
            }
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            if (!gameState.musicEnabled) return;
            
            const audio = new Audio();
            switch(type) {
                case 'success':
                    audio.src = 'https://assets.mixkit.co/active_storage/sfx/286/286-preview.mp3';
                    break;
                case 'coin':
                    audio.src = 'https://assets.mixkit.co/active_storage/sfx/294/294-preview.mp3';
                    break;
                case 'magic':
                    audio.src = 'https://assets.mixkit.co/active_storage/sfx/257/257-preview.mp3';
                    break;
            }
            audio.volume = 0.3;
            audio.play().catch(e => console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥"));
        }

        // åŠ è½½åŠ¨ç”»
        function startLoading() {
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 2;
                progressBar.style.width = progress + '%';
                
                if (progress <= 30) loadingText.textContent = "æ­£åœ¨è¿æ¥é˜´é˜³ä¸¤ç•Œ...";
                else if (progress <= 60) loadingText.textContent = "åŠ è½½å®¢äººæ•°æ®...";
                else if (progress <= 90) loadingText.textContent = "åˆå§‹åŒ–å®¢æ ˆç³»ç»Ÿ...";
                else loadingText.textContent = "å‡†å¤‡è¿æ¥å®¢äºº...";
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(finishLoading, 300);
                }
            }, 50);
        }

        // å®ŒæˆåŠ è½½
        function finishLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            updateDisplay();
            showNotification("æ¬¢è¿æ¥åˆ°çµå¢ƒå®¢æ ˆï¼");
            
            // å°è¯•æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
            try {
                const music = document.getElementById('bg-music');
                music.volume = 0.3;
                if (gameState.musicEnabled) {
                    setTimeout(() => music.play().catch(() => {}), 1000);
                }
            } catch(e) {}
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            // æ›´æ–°èµ„æº
            document.getElementById('silver-value').textContent = gameState.silver;
            document.getElementById('merit-value').textContent = gameState.merit;
            document.getElementById('rice-value').textContent = gameState.rice;
            document.getElementById('reputation-value').textContent = gameState.reputation;
            
            // æ›´æ–°å¤©æ•°
            document.getElementById('current-day').textContent = gameState.day;
            
            // æ›´æ–°å®¢äººåˆ—è¡¨
            displayGuests();
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = "info") {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            const colors = {
                success: "linear-gradient(135deg, #4CAF50, #45a049)",
                warning: "linear-gradient(135deg, #FF9800, #F57C00)",
                error: "linear-gradient(135deg, #F44336, #D32F2F)",
                info: "linear-gradient(135deg, #2196F3, #1976D2)",
                special: "linear-gradient(135deg, #9370DB, #8A2BE2)"
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (type === 'success') playSound('success');
            if (type === 'special') playSound('magic');
        }

        // æ˜¾ç¤ºå®¢äºº
        function displayGuests() {
            const emptyGuests = document.getElementById('empty-guests');
            const guestsList = document.getElementById('guests-list');
            
            // å…ˆæ¸…ç©ºå®¢äººåˆ—è¡¨
            guestsList.innerHTML = '';
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å®¢äºº
            if (gameState.guests.length === 0) {
                emptyGuests.style.display = 'block';
                return;
            }
            
            // æœ‰å®¢äººï¼šéšè—ç©ºçŠ¶æ€
            emptyGuests.style.display = 'none';
            
            // é‡æ–°ç”Ÿæˆæ‰€æœ‰å®¢äººå¡ç‰‡
            gameState.guests.forEach((guest, index) => {
                const guestCard = document.createElement('div');
                
                // åˆ¤æ–­æ˜¯å¦æ˜¯ç‰¹æ®Šå®¢äºº
                const isSpecial = guest.rarity === "ä¼ è¯´" || guest.rarity === "ç¨€æœ‰";
                guestCard.className = isSpecial ? 'guest-card special-guest' : 'guest-card';
                
                // ç±»å‹æ ·å¼
                let typeClass = 'type-live';
                if (guest.type === 'äº¡çµ') typeClass = 'type-ghost';
                if (guest.type === 'é¬¼ç¥' || guest.type === 'ç¥ä»™') typeClass = 'type-god';
                if (guest.type === 'å¦–æ€ª') typeClass = 'type-monster';
                
                // ç¨€æœ‰åº¦æ ‡ç­¾
                const rarityTag = guest.rarity ? 
                    `<span class="guest-rarity ${guest.rarity === 'ä¼ è¯´' ? 'legendary' : 'rare'}">${guest.rarity}</span>` : '';
                
                guestCard.innerHTML = `
                    <div class="guest-header">
                        <div class="guest-name">${guest.name}${rarityTag}</div>
                        <div class="guest-type ${typeClass}">
                            ${guest.type}
                        </div>
                    </div>
                    <div class="guest-desc">${guest.desc}</div>
                    ${guest.special ? `<div class="special-effect">âœ¨ ${guest.special}</div>` : ''}
                    <div class="guest-stats">
                        <div class="need-box">
                            <div>éœ€è¦</div>
                            <div style="font-size: 14px; color: #FF6B6B; margin-top: 3px;">
                                ${guest.needAmount} ${guest.need === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}
                            </div>
                        </div>
                        <div class="reward-box">
                            <div>å¥–åŠ±</div>
                            <div style="font-size: 14px; color: #4ECDC4; margin-top: 3px;">
                                ${guest.rewardAmount} ${guest.reward === 'silver' ? 'ç™½é“¶' : 
                                                       guest.reward === 'merit' ? 'åŠŸå¾·' : 
                                                       guest.reward === 'reputation' ? 'å£°æœ›' : 
                                                       guest.reward === 'rice' ? 'é˜´ç±³' : 'ç‰¹æ®Šç‰©å“'}
                            </div>
                        </div>
                    </div>
                    <div class="guest-actions">
                        <button class="btn btn-primary" onclick="serveGuest(${index})" ${canServe(guest) ? '' : 'disabled'}>
                            æ‹›å¾…
                        </button>
                        <button class="btn" onclick="chatGuest(${index})">
                            äº¤æµ
                        </button>
                        <button class="btn" onclick="bargainGuest(${index})" ${guest.type === 'äº¡çµ' ? 'disabled' : ''}>
                            è®®ä»·
                        </button>
                        <button class="btn btn-danger" onclick="refuseGuest(${index})">
                            æ‹’ç»
                        </button>
                    </div>
                `;
                
                guestsList.appendChild(guestCard);
            });
        }

        // æ£€æŸ¥æ˜¯å¦èƒ½æ‹›å¾…
        function canServe(guest) {
            if (guest.need === 'silver') {
                return gameState.silver >= guest.needAmount;
            } else {
                return gameState.merit >= guest.needAmount;
            }
        }

        // å¬å”¤å®¢äºº
        function generateGuest() {
            if (gameState.guests.length >= gameState.maxGuests) {
                showNotification(`å®¢æ ˆå·²æ»¡ï¼æœ€å¤šåªèƒ½æœ‰ ${gameState.maxGuests} ä½å®¢äººã€‚`, "warning");
                return;
            }
            
            // 15%æ¦‚ç‡å‡ºç°ç‰¹æ®Šå®¢äºº
            if (Math.random() < 0.15) {
                const randomIndex = Math.floor(Math.random() * specialGuests.length);
                const specialGuest = { ...specialGuests[randomIndex], id: Date.now() };
                
                gameState.guests.push(specialGuest);
                updateDisplay();
                
                playSound('magic');
                showNotification(`âœ¨ ç‰¹æ®Šå®¢äººã€${specialGuest.name}ã€‘é™ä¸´å®¢æ ˆï¼`, "special");
                return;
            }
            
            // æ™®é€šå®¢äºº
            const randomIndex = Math.floor(Math.random() * guestTypes.length);
            const guest = { ...guestTypes[randomIndex], id: Date.now() };
            
            gameState.guests.push(guest);
            updateDisplay();
            showNotification(`${guest.name}æ¥åˆ°äº†å®¢æ ˆ`, "info");
        }

        // æ‹›å¾…å®¢äºº
        function serveGuest(index) {
            const guest = gameState.guests[index];
            
            if (!canServe(guest)) {
                showNotification(`èµ„æºä¸è¶³ï¼éœ€è¦ ${guest.needAmount} ${guest.need === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}`, "error");
                return;
            }
            
            // æ‰£é™¤èµ„æº
            if (guest.need === 'silver') {
                gameState.silver -= guest.needAmount;
            } else {
                gameState.merit -= guest.needAmount;
            }
            
            // ç»™äºˆåŸºç¡€å¥–åŠ±
            if (guest.reward === 'silver') {
                gameState.silver += guest.rewardAmount;
            } else if (guest.reward === 'merit') {
                gameState.merit += guest.rewardAmount;
            } else if (guest.reward === 'reputation') {
                gameState.reputation += guest.rewardAmount;
            } else if (guest.reward === 'rice') {
                gameState.rice += guest.rewardAmount;
            } else if (guest.reward === 'special') {
                // è·å¾—ç‰¹æ®Šç‰©å“
                gameState.specialItems.push(guest.rewardAmount);
            }
            
            // ç‰¹æ®Šå®¢äººæ•ˆæœ
            if (guest.rarity === "ä¼ è¯´" || guest.rarity === "ç¨€æœ‰") {
                handleSpecialEffect(guest);
            }
            
            // äº¡çµ/é¬¼ç¥æ¶ˆè€—é˜´ç±³
            if (guest.type === 'äº¡çµ' || guest.type === 'é¬¼ç¥') {
                gameState.rice = Math.max(0, gameState.rice - 1);
            }
            
            // å¢åŠ å£°æœ›
            gameState.reputation += (guest.rarity ? 15 : 5);
            
            // ç§»é™¤å®¢äºº
            gameState.guests.splice(index, 1);
            
            updateDisplay();
            playSound('coin');
            
            if (guest.rarity) {
                showNotification(`âœ¨ æˆåŠŸæ‹›å¾…ã€${guest.name}ã€‘ï¼è·å¾—ç‰¹æ®Šå¥–åŠ±ï¼`, "success");
            } else {
                showNotification(`æˆåŠŸæ‹›å¾…${guest.name}ï¼Œè·å¾—${guest.rewardAmount}${guest.reward === 'silver' ? 'ç™½é“¶' : 'åŠŸå¾·'}ï¼`, "success");
            }
        }

        // ç‰¹æ®Šæ•ˆæœå¤„ç†
        function handleSpecialEffect(guest) {
            switch(guest.name) {
                case "å­Ÿå©†":
                    gameState.merit += 50;
                    showNotification("å­Ÿå©†æ±¤æ•ˆæœï¼šåŠŸå¾·+50", "info");
                    break;
                case "è´¢ç¥":
                    gameState.silver += 100; // é¢å¤–å¥–åŠ±
                    showNotification("è´¢ç¥ç¥ç¦ï¼šé¢å¤–è·å¾—100ç™½é“¶ï¼", "success");
                    break;
                case "åœŸåœ°å…¬":
                    gameState.ricePerDay += 2;
                    showNotification("åœŸåœ°ç¥ç¦ï¼šé˜´ç±³äº§é‡æ°¸ä¹…+2/å¤©", "success");
                    break;
                case "é’Ÿé¦—":
                    gameState.specialItems.push("æ–©é¬¼å‰‘");
                    showNotification("è·å¾—ç‰¹æ®Šç‰©å“ï¼šæ–©é¬¼å‰‘", "success");
                    break;
                case "ç‹ä»™":
                    gameState.reputation += 30;
                    showNotification("ç‹ä»™é­…æƒ‘ï¼šå£°æœ›+30", "success");
                    break;
                case "èŠ±é­":
                    gameState.reputation += 30;
                    gameState.silver += 40;
                    showNotification("èŠ±é­å€¾åŸä¸€ç¬‘ï¼šå£°æœ›+30ï¼Œç™½é“¶+40", "success");
                    break;
                case "é…’ä»™":
                    gameState.specialItems.push("ä»™é…’");
                    showNotification("è·å¾—ç‰¹æ®Šç‰©å“ï¼šä»™é…’", "success");
                    break;
            }
        }

        // ä½¿ç”¨ç‰¹æ®Šç‰©å“
        function useSpecialItem() {
            if (gameState.specialItems.length === 0) {
                showNotification("æ²¡æœ‰ç‰¹æ®Šç‰©å“å¯ä»¥ä½¿ç”¨", "warning");
                return;
            }
            
            let itemList = "é€‰æ‹©è¦ä½¿ç”¨çš„ç‰¹æ®Šç‰©å“ï¼š\n\n";
            gameState.specialItems.forEach((item, index) => {
                itemList += `${index + 1}. ${item}\n`;
            });
            
            const choice = prompt(itemList + "\nè¾“å…¥ç¼–å·ï¼ˆè¾“å…¥0å–æ¶ˆï¼‰ï¼š");
            if (!choice || choice === "0") return;
            
            const index = parseInt(choice) - 1;
            if (isNaN(index) || index < 0 || index >= gameState.specialItems.length) {
                showNotification("æ— æ•ˆçš„é€‰æ‹©", "error");
                return;
            }
            
            const item = gameState.specialItems[index];
            
            // ä½¿ç”¨ç‰©å“æ•ˆæœ
            switch(item) {
                case "æ–©é¬¼å‰‘":
                    gameState.merit += 100;
                    showNotification("ä½¿ç”¨æ–©é¬¼å‰‘ï¼šè·å¾—100åŠŸå¾·", "success");
                    break;
                case "ä»™é…’":
                    const random = Math.random();
                    if (random < 0.33) {
                        gameState.silver += 80;
                        showNotification("ç•…é¥®ä»™é…’ï¼šè·å¾—80ç™½é“¶", "success");
                    } else if (random < 0.66) {
                        gameState.merit += 60;
                        showNotification("ç•…é¥®ä»™é…’ï¼šè·å¾—60åŠŸå¾·", "success");
                    } else {
                        gameState.rice += 25;
                        showNotification("ç•…é¥®ä»™é…’ï¼šè·å¾—25é˜´ç±³", "success");
                    }
                    break;
                default:
                    showNotification(`ä½¿ç”¨äº†ï¼š${item}`, "info");
            }
            
            // ç§»é™¤ä½¿ç”¨çš„ç‰©å“
            gameState.specialItems.splice(index, 1);
            updateDisplay();
        }

        // ä¸å®¢äººäº¤æµ
        function chatGuest(index) {
            const guest = gameState.guests[index];
            const messages = [
                `${guest.name}è¯´ï¼š"æŒæŸœçš„ç”Ÿæ„å…´éš†ï¼"`,
                `ä¸${guest.name}èŠå¤©ï¼Œå¿ƒæƒ…æ„‰æ‚¦ï¼`,
                `${guest.name}è®²è¿°äº†ä¸€ä¸ªæœ‰è¶£çš„æ•…äº‹...`,
                `ä»${guest.name}é‚£é‡Œå¬åˆ°äº†ä¸€äº›ä¼ é—»...`
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            showNotification(message, "info");
        }

        // è®®ä»·
        function bargainGuest(index) {
            const guest = gameState.guests[index];
            
            if (guest.type === 'äº¡çµ' || guest.type === 'é¬¼ç¥') {
                showNotification("æ­¤å®¢äººæ— æ³•è®®ä»·", "warning");
                return;
            }
            
            if (Math.random() > 0.5) {
                const discount = Math.floor(guest.needAmount * 0.2);
                guest.needAmount = Math.max(1, guest.needAmount - discount);
                showNotification(`è®®ä»·æˆåŠŸï¼è¦æ±‚é™ä½${discount}`, "success");
                updateDisplay();
            } else {
                showNotification("è®®ä»·å¤±è´¥", "warning");
            }
        }

        // æ‹’ç»å®¢äºº
        function refuseGuest(index) {
            const guest = gameState.guests[index];
            gameState.guests.splice(index, 1);
            updateDisplay();
            showNotification(`æ‹’ç»äº†${guest.name}`);
        }

        // å¤–å‡ºæ¢ç´¢
        function explore() {
            const events = [
                { message: "å‘ç°å®ç®±ï¼Œè·å¾—50ç™½é“¶ï¼", reward: () => gameState.silver += 50 },
                { message: "æ•‘åŠ©è·¯äººï¼Œè·å¾—15å£°æœ›", reward: () => gameState.reputation += 15 },
                { message: "é‡‡é›†è‰è¯ï¼Œè·å¾—10é˜´ç±³", reward: () => gameState.rice += 10 },
                { message: "é­é‡å±±è´¼ï¼ŒæŸå¤±30ç™½é“¶", reward: () => gameState.silver = Math.max(0, gameState.silver - 30) },
                { message: "å‘ç°ç¥ç§˜æ´ç©´ï¼Œè·å¾—20åŠŸå¾·", reward: () => gameState.merit += 20 }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            event.reward();
            showNotification(event.message, "info");
            updateDisplay();
        }

        // å®¢æ ˆå‡çº§
        function upgradeInn() {
            if (gameState.silver < 50) {
                showNotification("éœ€è¦50ç™½é“¶æ‰èƒ½å‡çº§ï¼", "error");
                return;
            }
            
            const options = ["æœ€å¤§å®¢äºº+1", "é˜´ç±³äº§å‡º+2/å¤©", "å£°æœ›+10", "ç‰¹æ®Šå®¢äººæ¦‚ç‡+5%"];
            const choice = prompt(`é€‰æ‹©å‡çº§é¡¹ç›®ï¼ˆèŠ±è´¹50ç™½é“¶ï¼‰ï¼š\n1. ${options[0]}\n2. ${options[1]}\n3. ${options[2]}\n4. ${options[3]}\n\nè¾“å…¥ç¼–å·ï¼š`);
            
            if (!choice) return;
            
            const index = parseInt(choice) - 1;
            if (isNaN(index) || index < 0 || index >= options.length) {
                showNotification("æ— æ•ˆçš„é€‰æ‹©", "error");
                return;
            }
            
            gameState.silver -= 50;
            gameState.innLevel += 1;
            
            if (index === 0) {
                gameState.maxGuests += 1;
                showNotification("æ‰©å»ºå®¢æˆ¿å®Œæˆï¼æœ€å¤§å®¢äºº+1", "success");
            } else if (index === 1) {
                gameState.ricePerDay += 2;
                showNotification("æ”¹è‰¯å†œç”°å®Œæˆï¼é˜´ç±³äº§å‡º+2/å¤©", "success");
            } else if (index === 2) {
                gameState.reputation += 10;
                showNotification("è£…é¥°å®¢æ ˆå®Œæˆï¼å£°æœ›+10", "success");
            } else if (index === 3) {
                showNotification("å®¢æ ˆåå£°æå‡ï¼ç‰¹æ®Šå®¢äººæ›´å®¹æ˜“å‡ºç°", "success");
            }
            
            updateDisplay();
        }

        // ä¸‹ä¸€å¤©
        function nextDay() {
            gameState.day += 1;
            gameState.rice += gameState.ricePerDay;
            
            // æ¸…ç©ºæœªæ‹›å¾…çš„å®¢äºº
            if (gameState.guests.length > 0) {
                gameState.guests = [];
                showNotification("æ–°çš„ä¸€å¤©å¼€å§‹ï¼Œæ˜¨æ—¥å®¢äººå·²ç¦»å¼€", "warning");
            }
            
            // éšæœºäº‹ä»¶
            if (Math.random() > 0.7) {
                gameState.silver += 20;
                showNotification("ä»Šå¤©å®¢æ ˆç”Ÿæ„å…´éš†ï¼è·å¾—20ç™½é“¶", "success");
            }
            
            updateDisplay();
            showNotification(`è¿›å…¥ç¬¬${gameState.day}å¤©ï¼`, "success");
        }

        // æŸ¥çœ‹æˆå°±
        function checkAchievements() {
            const achievements = [
                { name: "åˆæ¥ä¹åˆ°", desc: "æ‹›å¾…ç¬¬ä¸€ä½å®¢äºº", done: gameState.reputation > 0 },
                { name: "åŠŸå¾·æ— é‡", desc: "ç§¯ç´¯500åŠŸå¾·", done: gameState.merit >= 500 },
                { name: "å¯Œå¯æ•Œå›½", desc: "æ‹¥æœ‰1000ç™½é“¶", done: gameState.silver >= 1000 },
                { name: "å®¢æ ˆå¤§å¸ˆ", desc: "å®¢æ ˆè¾¾åˆ°5çº§", done: gameState.innLevel >= 5 },
                { name: "ç‰¹æ®Šæ‹›å¾…", desc: "æ‹›å¾…10ä½ç‰¹æ®Šå®¢äºº", done: gameState.reputation >= 150 },
                { name: "é˜´é˜³é€šåƒ", desc: "æ‹›å¾…æ‰€æœ‰ç±»å‹çš„å®¢äºº", done: gameState.reputation >= 100 }
            ];
            
            let message = "ğŸ† æˆå°±åˆ—è¡¨ï¼š\n\n";
            achievements.forEach(ach => {
                message += `${ach.done ? "âœ…" : "â¬œ"} ${ach.name}\n`;
                message += `   ${ach.desc}\n\n`;
            });
            
            alert(message);
        }

        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('lingjingInnSave', JSON.stringify(gameState));
            showNotification("æ¸¸æˆå·²ä¿å­˜ï¼", "success");
        }

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const saveData = localStorage.getItem('lingjingInnSave');
            if (saveData) {
                gameState = JSON.parse(saveData);
                updateDisplay();
                showNotification("æ¸¸æˆå·²åŠ è½½ï¼", "success");
            } else {
                showNotification("æ²¡æœ‰ä¿å­˜çš„æ¸¸æˆï¼", "error");
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            if (confirm("ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦éƒ½ä¼šä¸¢å¤±ï¼")) {
                gameState = {
                    silver: 100,
                    merit: 100,
                    rice: 20,
                    reputation: 0,
                    day: 1,
                    guests: [],
                    innLevel: 1,
                    maxGuests: 3,
                    ricePerDay: 5,
                    specialItems: [],
                    musicEnabled: true
                };
                updateDisplay();
                showNotification("æ¸¸æˆå·²é‡ç½®ï¼", "success");
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹
        window.onload = startLoading;
    </script>
</body>
</html>
